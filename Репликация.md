* На 1 ВМ создаем таблицы test для записи, test2 для запросов на чтение.

```sql
alter system set wal_level = logical;
```
sudo pg_ctlcluster 14 main restart

```sql
test_vm1=# show wal_level;
 wal_level
-----------
 logical
(1 row)


```

```sql
Для записи

test_vm1=# create table test (name varchar(50));
CREATE TABLE


```

```sql
Для чтения

test_vm1=# create table test2 (name varchar(50));
CREATE TABLE

```

```sql
 \dt
         List of relations
 Schema | Name  | Type  |  Owner
--------+-------+-------+----------
 public | test  | table | postgres
 public | test2 | table | postgres
(2 rows)


```

-------------------------------------------------

* Создаем публикацию таблицы test и подписываемся на публикацию таблицы test2 с ВМ №2.

```sql

test_vm1=# create publication table_test for table test;
CREATE PUBLICATION
test_vm1=#

\dRp+

test_vm1=# \dRp+
                           Publication table_test
  Owner   | All tables | Inserts | Updates | Deletes | Truncates | Via root
----------+------------+---------+---------+---------+-----------+----------
 postgres | f          | t       | t       | t       | t         | f
Tables:
    "public.test"

test_vm1=# create subscription table_test2
connection 'host=192.168.61.131 port=5432 user=postgres password=123 dbname=test_vm2'
publication test_pub with (copy_data = true);
NOTICE:  created replication slot "table_test2" on publisher
CREATE SUBSCRIPTION



```  


-------------------------------------------------


* На 2 ВМ создаем таблицы test2 для записи, test для запросов на чтение.

```sql
alter system set wal_level = logical;
```
sudo pg_ctlcluster 14 main restart

```sql
test_vm2=# show wal_level;
 wal_level
-----------
 logical
(1 row)


```


```sql
test_vm2=# create table test2 (name varchar(50));

```

```sql

test_vm2=# create table test (name varchar(50));



```

```sql

 \dt
         List of relations
 Schema | Name  | Type  |  Owner
--------+-------+-------+----------
 public | test  | table | postgres
 public | test2 | table | postgres
(2 rows)


```

--------------------------------------------------

* Создаем публикацию таблицы test2 и подписываемся на публикацию таблицы test1 с ВМ №1.

```sql
test_vm2=# create publication table_test2 for table test2;
CREATE PUBLICATION

test_vm2=# \dRp+
                          Publication table_test2
  Owner   | All tables | Inserts | Updates | Deletes | Truncates | Via root
----------+------------+---------+---------+---------+-----------+----------
 postgres | f          | t       | t       | t       | t         | f
Tables:
    "public.test2"


test_vm2=# create subscription table_test
connection 'host=192.168.61.130 port=5432 user=postgres password=123 dbname=test_vm1'
publication test_pub with (copy_data = true);
NOTICE:  created replication slot "table_test" on publisher
CREATE SUBSCRIPTION


```


-------------------------------------------------

* 3 ВМ использовать как реплику для чтения и бэкапов (подписаться на таблицы из ВМ №1 и №2 ).




-----------------------------------------------


* co * реализовать горячее реплицирование для высокой доступности на 4ВМ. Источником должна выступать ВМ №3. Написать с какими проблемами столкнулись.
 
    
 
--------------------------------------------
